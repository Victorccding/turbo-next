version: 1
applications:
  - appRoot: apps/app
    frontend:
      phases:
        preBuild:
          commands:
            - cd ../../
            - npx pnpm install
        build:
          commands:
            - npx pnpm run build
            - export STANDALONE=apps/app/.next/standalone
            - mv $STANDALONE/apps/app/node_modules/* $STANDALONE/node_modules
            - mv $STANDALONE/node_modules/.pnpm/* $STANDALONE/node_modules/
            - mv $STANDALONE/apps/app/.next $STANDALONE/.next
            - mv $STANDALONE/apps/app/server.js $STANDALONE/server.js
      artifacts:
        # IMPORTANT - Please verify your build output directory
        baseDirectory: .next
        files:
          - '**/*'